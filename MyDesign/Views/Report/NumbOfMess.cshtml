@model IEnumerable<eSupervisor_Beta.MyClasses.UserAndNumbOfMess>
@{
    ViewBag.Title = "NumbOfMess";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Report: Number of Messages of Students in last 7 days</h2>
<table id="tblNumOfMess">
    <tr>
        <td>Student ID</td>
        <td>First Name</td>
        <td>Last Name</td>
        <td>Number of messages in last 7</td>
    </tr>
    @foreach (var item in Model)
    {
        if (item.user.roleID == 3)
        {
            <tr class="rowid">
                <td>
                    @Html.DisplayFor(modelItem => item.user.id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.user.firstName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.user.lastName)
                </td>
                <td class="numValue">
                    <div class="sta-bar" style="height:5px; float:left; margin-right:5px;margin-top:8px;"></div>
                    @Html.DisplayFor(modelItem => item.numbOfMess)
                </td>
            </tr>
        }
    }
</table>

<h2>Report: Number of Messages of Supervisors in last 7 days</h2>
<table>
    <tr>
        <td>Supervisor ID</td>
        <td>First Name</td>
        <td>Last Name</td>
        <td>Number of messages in last 7</td>
    </tr>
    @foreach (var item in Model)
    {
        if (item.user.roleID == 2)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.user.id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.user.firstName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.user.lastName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.numbOfMess)
                </td>
            </tr>
        }
    }
</table>

@section Scripts{
    <script>
        $(document).ready(function () {
            var max = 0;
            $(".rowid").find(".numValue").each(function () {
                var test = parseInt($(this).text());
                if (test > max) {
                    max = test;
                }
            });
            $(".rowid").find(".numValue").each(function () {
                var test = parseInt($(this).text());
                $(this).find(".sta-bar").css('width', test * 200 / max);
                if(test <= max/3)
                    $(this).find(".sta-bar").css('background', 'red');//smallest
                else if (test >= max / 3 && test <= max / 2)
                    $(this).find(".sta-bar").css('background', 'yellow');//acceptable
                else
                    $(this).find(".sta-bar").css('background', 'green');//strong
                if(test==0)
                    $(this).find(".sta-bar").css('width', 5);
            });
        });
    </script>
}